<html>
<head>
<title>test how to get PHP function</title>
<link href="css/adminStyle.css" type="text/css" rel="stylesheet" />
<script src="js/jquery-1.9.1.js" type="text/javascript"></script>
</head>
<body>
<script type="text/javascript">
jQuery.ajax({
	url:"getDB.php",
	type:"GET",
	dateType:"JSON",
	success:function(data){
		//alert("haha: "+data);
		//alert("success");
		var arrJson = JSON.parse("[" + data.substring(0,data.length-1) + "]");
		//var arrJson = "[" + data.substring(0,data.length-1) + "]";
		//alert(arrJson);
		//var arrJson = data.substring(0,data.length-1);
		//alert(typeof arrJson);
	//function creatMapBy_id(arrJson){ 
        var _idMap={};  
        var len = arrJson.length;
			//console.log("JSON ARRAY:",arrJson);
			//alert("len::" + len);
        for(var i=0;i<len;i++){  
          
            if(_idMap[arrJson[i]._id] == undefined){  
                var list = [];  
                list.push(arrJson[i]);  
                _idMap[arrJson[i]._id] = list;  
            }else{  
                _idMap[arrJson[i]._id].push(arrJson[i]);  
            }  
              
        }  
        var str="<div class='tPageBody'><table border='1' cellpadding='0' cellspacing='0'><tr style='font-size:18px;font-weight:bold;height:40px;background:url(images/title_bg.png) repeat-x;'><th style='text-align:center;border:0;border-right:1px solid #cccccc;border-bottom:1px solid #cccccc;' wcaseIdth='20%'>caseId</th><th style='text-align:center;border:0;border-right:1px solid #ccc;border-bottom:1px solid #ccc;' wcaseIdth='20%'>title</th><th style='text-align:center;border:0;border-right:1px solid #ccc;border-bottom:1px solid #ccc;' wcaseIdth='20%'>description</th><th  style='text-align:center;border:0;border-right:1px solid #ccc;border-bottom:1px solid #ccc;' wcaseIdth='20%'>state</th><th style='text-align:center;border:0;border-bottom:1px solid #ccc;border-right:0;' wcaseIdth='20%'>email</th></tr>";    
        for(var _id in _idMap){  
            var stu = _idMap[_id]; 
          //  str+="<tr><td rowspan='"+stu.length+"'>"+_id+"</td>";  
		  str+="<tr><td>"+_id+"</td>";
            for(var i = 0;i < stu.length;i++){ 
                str+="<td>"+stu[i].title+"</td><td>"+stu[i].description + "</td><td>" + stu[i].state + "</td><td style='border-right:0;'>" + stu[i].email + "</td></tr></tr>";
            }   
        }  
        str+="</table></div>";
        $("body").html(str);
		$(".tPageBody table tr:even").addClass("teven");
  //  } 
	  	$(document).ready(function(){
		$("td").click(function(){
		var tValue = $(this).text();
		tValue = parseInt(tValue);	

		//alert(tValue);
		//alert(typeof tValue);
		//alert("tValue::" + tValue);
		//	$.post("subCase.php", {tValue:tValue});
		
		showResult(tValue);

		});
	  });
	  
	},
	error: function(XMLHttpRequest, textStatus, errorThrown) {
			alert(errorThrown);
		}
}
);
$(document).ready(function(){
	//$("td").click(function(){
	//alert("tdClick");
	//});
});



function showResult(message){

	//alert("this is " + message);



	$.ajax({
		  
		  type: 'POST',
		  url: "cases.php",
		  data: {tValue:message},
		 success: function(msg){

		//alert(msg+"abc");

		var arrJson = JSON.parse("[" + msg.substring(0,msg.length-1) + "]");
		
		//alert(arrJson);
		
        var caseIdMap={};  
        //alert(caseIdMap); returns an object.
        var len = arrJson.length;

        //alert(len);
			//console.log("JSON ARRAY:",arrJson);
			//alert("len::" + len);
        for(var i=0;i<len;i++){  
          
            if(caseIdMap[arrJson[i].caseId] == undefined){  
                var list = [];  
                list.push(arrJson[i]);  
                caseIdMap[arrJson[i].caseId] = list;  
            }else{  
                caseIdMap[arrJson[i].caseId].push(arrJson[i]);  
            }  
              
        }  
        var str="<div class='tPageBody'><table border='1' cellpadding='0' cellspacing='0'><tr style='font-size:18px;font-weight:bold;height:40px;background:url(images/title_bg.png) repeat-x;'><th style='text-align:center;border:0;border-right:1px solid #cccccc;border-bottom:1px solid #cccccc;' wcaseIdth='20%'>caseId</th><th style='text-align:center;border:0;border-right:1px solid #ccc;border-bottom:1px solid #ccc;' wcaseIdth='20%'>ResultID</th><th style='text-align:center;border:0;border-right:1px solid #ccc;border-bottom:1px solid #ccc;' wcaseIdth='20%'>caseURL</th><th style='text-align:center;border:0;border-right:1px solid #ccc;border-bottom:1px solid #ccc;' wcaseIdth='20%'>Result</th></tr>";  
        for(var caseId in caseIdMap){  
            var stu = caseIdMap[caseId]; 
          //  str+="<tr><td rowspan='"+stu.length+"'>"+caseId+"</td>";  
		  //str+="<tr><td>"+caseId+"</td>";
            for(var i = 0;i < stu.length;i++){ 
            	count = i+1;
            	//alert(stu[i].caseResult[3].reslut);
                //str+="<td>"+stu[i]._id+"</td><td>"+stu[i].caseResult + "</td><td>" + stu[i]._id + "</td><td style='border-right:0;'>" + stu[i].caseResult + "</td></tr></tr>";
            	str+="<tr><td>"+caseId+"</td>"+"<td>"+count+"</td>"+"<td>"+stu[i].caseResult[2].reslut+"</td><td>"+stu[i].caseResult[3].reslut + "</td></tr>";
            
            }   
        }  
        str+="</table></div>";
        $("body").html(str);
		$(".tPageBody table tr:even").addClass("teven");














			//window.open('subCase.html');
		  }
		});



}





</script>
</body>
</html>